/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */
"use strict";var accepts=require("accepts"),isIP=require("node:net").isIP,typeis=require("type-is"),http=require("node:http"),fresh=require("fresh"),parseRange=require("range-parser"),parse=require("parseurl"),proxyaddr=require("proxy-addr"),req=Object.create(http.IncomingMessage.prototype);function defineGetter(e,r,t){Object.defineProperty(e,r,{configurable:!0,enumerable:!0,get:t})}module.exports=req,req.get=req.header=function(e){if(!e)throw new TypeError("name argument is required to req.get");if("string"!=typeof e)throw new TypeError("name must be a string to req.get");var r=e.toLowerCase();switch(r){case"referer":case"referrer":return this.headers.referrer||this.headers.referer;default:return this.headers[r]}},req.accepts=function(){var e=accepts(this);return e.types.apply(e,arguments)},req.acceptsEncodings=function(){var e=accepts(this);return e.encodings.apply(e,arguments)},req.acceptsCharsets=function(){var e=accepts(this);return e.charsets.apply(e,arguments)},req.acceptsLanguages=function(...e){return accepts(this).languages(...e)},req.range=function(e,r){var t=this.get("Range");if(t)return parseRange(e,t,r)},defineGetter(req,"query",function(){var e=this.app.get("query parser fn");return e?e(parse(this).query):Object.create(null)}),req.is=function(e){var r=e;if(!Array.isArray(e)){r=new Array(arguments.length);for(var t=0;t<r.length;t++)r[t]=arguments[t]}return typeis(this,r)},defineGetter(req,"protocol",function(){var e=this.socket.encrypted?"https":"http";if(!this.app.get("trust proxy fn")(this.socket.remoteAddress,0))return e;var r=this.get("X-Forwarded-Proto")||e,t=r.indexOf(",");return-1!==t?r.substring(0,t).trim():r.trim()}),defineGetter(req,"secure",function(){return"https"===this.protocol}),defineGetter(req,"ip",function(){var e=this.app.get("trust proxy fn");return proxyaddr(this,e)}),defineGetter(req,"ips",function(){var e=this.app.get("trust proxy fn"),r=proxyaddr.all(this,e);return r.reverse().pop(),r}),defineGetter(req,"subdomains",function(){var e=this.hostname;if(!e)return[];var r=this.app.get("subdomain offset"),t=isIP(e)?[e]:e.split(".").reverse();return t.slice(r)}),defineGetter(req,"path",function(){return parse(this).pathname}),defineGetter(req,"host",function(){var e=this.app.get("trust proxy fn"),r=this.get("X-Forwarded-Host");return r&&e(this.socket.remoteAddress,0)?-1!==r.indexOf(",")&&(r=r.substring(0,r.indexOf(",")).trimRight()):r=this.get("Host"),r||void 0}),defineGetter(req,"hostname",function(){var e=this.host;if(e){var r="["===e[0]?e.indexOf("]")+1:0,t=e.indexOf(":",r);return-1!==t?e.substring(0,t):e}}),defineGetter(req,"fresh",function(){var e=this.method,r=this.res,t=r.statusCode;return("GET"===e||"HEAD"===e)&&((t>=200&&t<300||304===t)&&fresh(this.headers,{etag:r.get("ETag"),"last-modified":r.get("Last-Modified")}))}),defineGetter(req,"stale",function(){return!this.fresh}),defineGetter(req,"xhr",function(){return"xmlhttprequest"===(this.get("X-Requested-With")||"").toLowerCase()});