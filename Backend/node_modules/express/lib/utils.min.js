/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */
"use strict";var{METHODS:METHODS}=require("node:http"),contentType=require("content-type"),etag=require("etag"),mime=require("mime-types"),proxyaddr=require("proxy-addr"),qs=require("qs"),querystring=require("node:querystring");const{Buffer:Buffer}=require("node:buffer");function acceptParams(e){for(var r=e.length,t=-1===(o=e.indexOf(";"))?r:o,n={value:e.slice(0,t).trim(),quality:1,params:{}};t<r;){var a=e.indexOf("=",t);if(-1===a)break;var o,u=-1===(o=e.indexOf(";",t))?r:o;if(a>u)t=e.lastIndexOf(";",a-1)+1;else{var i=e.slice(t,a).trim(),s=e.slice(a+1,u).trim();"q"===i?n.quality=parseFloat(s):n.params[i]=s,t=u+1}}return n}function createETagGenerator(e){return function(r,t){var n=Buffer.isBuffer(r)?r:Buffer.from(r,t);return etag(n,e)}}function parseExtendedQueryString(e){return qs.parse(e,{allowPrototypes:!0})}exports.methods=METHODS.map(e=>e.toLowerCase()),exports.etag=createETagGenerator({weak:!1}),exports.wetag=createETagGenerator({weak:!0}),exports.normalizeType=function(e){return~e.indexOf("/")?acceptParams(e):{value:mime.lookup(e)||"application/octet-stream",params:{}}},exports.normalizeTypes=function(e){return e.map(exports.normalizeType)},exports.compileETag=function(e){var r;if("function"==typeof e)return e;switch(e){case!0:case"weak":r=exports.wetag;break;case!1:break;case"strong":r=exports.etag;break;default:throw new TypeError("unknown value for etag function: "+e)}return r},exports.compileQueryParser=function(e){var r;if("function"==typeof e)return e;switch(e){case!0:case"simple":r=querystring.parse;break;case!1:break;case"extended":r=parseExtendedQueryString;break;default:throw new TypeError("unknown value for query parser function: "+e)}return r},exports.compileTrust=function(e){return"function"==typeof e?e:!0===e?function(){return!0}:"number"==typeof e?function(r,t){return t<e}:("string"==typeof e&&(e=e.split(",").map(function(e){return e.trim()})),proxyaddr.compile(e||[]))},exports.setCharset=function(e,r){if(!e||!r)return e;var t=contentType.parse(e);return t.parameters.charset=r,contentType.format(t)};