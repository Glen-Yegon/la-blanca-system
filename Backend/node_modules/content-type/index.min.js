/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
"use strict";var PARAM_REGEXP=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,TEXT_REGEXP=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,TOKEN_REGEXP=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,QESC_REGEXP=/\\([\u000b\u0020-\u00ff])/g,QUOTE_REGEXP=/([\\"])/g,TYPE_REGEXP=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;function format(e){if(!e||"object"!=typeof e)throw new TypeError("argument obj is required");var r=e.parameters,t=e.type;if(!t||!TYPE_REGEXP.test(t))throw new TypeError("invalid type");var n=t;if(r&&"object"==typeof r)for(var a,o=Object.keys(r).sort(),i=0;i<o.length;i++){if(a=o[i],!TOKEN_REGEXP.test(a))throw new TypeError("invalid parameter name");n+="; "+a+"="+qstring(r[a])}return n}function parse(e){if(!e)throw new TypeError("argument string is required");var r="object"==typeof e?getcontenttype(e):e;if("string"!=typeof r)throw new TypeError("argument string is required to be a string");var t=r.indexOf(";"),n=-1!==t?r.slice(0,t).trim():r.trim();if(!TYPE_REGEXP.test(n))throw new TypeError("invalid media type");var a=new ContentType(n.toLowerCase());if(-1!==t){var o,i,E;for(PARAM_REGEXP.lastIndex=t;i=PARAM_REGEXP.exec(r);){if(i.index!==t)throw new TypeError("invalid parameter format");t+=i[0].length,o=i[1].toLowerCase(),34===(E=i[2]).charCodeAt(0)&&-1!==(E=E.slice(1,-1)).indexOf("\\")&&(E=E.replace(QESC_REGEXP,"$1")),a.parameters[o]=E}if(t!==r.length)throw new TypeError("invalid parameter format")}return a}function getcontenttype(e){var r;if("function"==typeof e.getHeader?r=e.getHeader("content-type"):"object"==typeof e.headers&&(r=e.headers&&e.headers["content-type"]),"string"!=typeof r)throw new TypeError("content-type header is missing from object");return r}function qstring(e){var r=String(e);if(TOKEN_REGEXP.test(r))return r;if(r.length>0&&!TEXT_REGEXP.test(r))throw new TypeError("invalid parameter value");return'"'+r.replace(QUOTE_REGEXP,"\\$1")+'"'}function ContentType(e){this.parameters=Object.create(null),this.type=e}exports.format=format,exports.parse=parse;