"use strict";var GetIntrinsic=require("../"),test=require("tape"),forEach=require("for-each"),debug=require("object-inspect"),generatorFns=require("make-generator-function")(),asyncFns=require("make-async-function").list(),asyncGenFns=require("make-async-generator-function")(),mockProperty=require("mock-property"),callBound=require("call-bound"),v=require("es-value-fixtures"),$gOPD=require("gopd"),DefinePropertyOrThrow=require("es-abstract/2023/DefinePropertyOrThrow"),$isProto=callBound("%Object.prototype.isPrototypeOf%");test("export",function(t){t.equal(typeof GetIntrinsic,"function","it is a function"),t.equal(GetIntrinsic.length,2,"function has length of 2"),t.end()}),test("throws",function(t){t.throws(function(){GetIntrinsic("not an intrinsic")},SyntaxError,"nonexistent intrinsic throws a syntax error"),t.throws(function(){GetIntrinsic("")},TypeError,"empty string intrinsic throws a type error"),t.throws(function(){GetIntrinsic(".")},SyntaxError,'"just a dot" intrinsic throws a syntax error'),t.throws(function(){GetIntrinsic("%String")},SyntaxError,"Leading % without trailing % throws a syntax error"),t.throws(function(){GetIntrinsic("String%")},SyntaxError,"Trailing % without leading % throws a syntax error"),t.throws(function(){GetIntrinsic("String['prototype]")},SyntaxError,"Dynamic property access is disallowed for intrinsics (unterminated string)"),t.throws(function(){GetIntrinsic("%Proxy.prototype.undefined%")},TypeError,"Throws when middle part doesn't exist (%Proxy.prototype.undefined%)"),t.throws(function(){GetIntrinsic("%Array.prototype%garbage%")},SyntaxError,"Throws with extra percent signs"),t.throws(function(){GetIntrinsic("%Array.prototype%push%")},SyntaxError,"Throws with extra percent signs, even on an existing intrinsic"),forEach(v.nonStrings,function(r){t.throws(function(){GetIntrinsic(r)},TypeError,debug(r)+" is not a String")}),forEach(v.nonBooleans,function(r){t.throws(function(){GetIntrinsic("%",r)},TypeError,debug(r)+" is not a Boolean")}),forEach(["toString","propertyIsEnumerable","hasOwnProperty"],function(r){t.throws(function(){GetIntrinsic(r)},SyntaxError,debug(r)+" is not an intrinsic")}),t.end()}),test("base intrinsics",function(t){t.equal(GetIntrinsic("%Object%"),Object,"%Object% yields Object"),t.equal(GetIntrinsic("Object"),Object,"Object yields Object"),t.equal(GetIntrinsic("%Array%"),Array,"%Array% yields Array"),t.equal(GetIntrinsic("Array"),Array,"Array yields Array"),t.end()}),test("dotted paths",function(t){t.equal(GetIntrinsic("%Object.prototype.toString%"),Object.prototype.toString,"%Object.prototype.toString% yields Object.prototype.toString"),t.equal(GetIntrinsic("Object.prototype.toString"),Object.prototype.toString,"Object.prototype.toString yields Object.prototype.toString"),t.equal(GetIntrinsic("%Array.prototype.push%"),Array.prototype.push,"%Array.prototype.push% yields Array.prototype.push"),t.equal(GetIntrinsic("Array.prototype.push"),Array.prototype.push,"Array.prototype.push yields Array.prototype.push"),test("underscore paths are aliases for dotted paths",{skip:!Object.isFrozen||Object.isFrozen(Object.prototype)},function(t){var r=GetIntrinsic("%ObjProto_toString%");forEach(["%Object.prototype.toString%","Object.prototype.toString","%ObjectPrototype.toString%","ObjectPrototype.toString","%ObjProto_toString%","ObjProto_toString"],function(e){DefinePropertyOrThrow(Object.prototype,"toString",{"[[Value]]":function(){return r.apply(this,arguments)}}),t.equal(GetIntrinsic(e),r,e+" yields original Object.prototype.toString")}),DefinePropertyOrThrow(Object.prototype,"toString",{"[[Value]]":r}),t.end()}),test("dotted paths cache",{skip:!Object.isFrozen||Object.isFrozen(Object.prototype)},function(t){var r=GetIntrinsic("%Object.prototype.propertyIsEnumerable%");forEach(["%Object.prototype.propertyIsEnumerable%","Object.prototype.propertyIsEnumerable","%ObjectPrototype.propertyIsEnumerable%","ObjectPrototype.propertyIsEnumerable"],function(e){var n=mockProperty(Object.prototype,"propertyIsEnumerable",{value:function(){return r.apply(this,arguments)}});t.equal(GetIntrinsic(e),r,e+" yields cached Object.prototype.propertyIsEnumerable"),n()}),t.end()}),test("dotted path reports correct error",function(t){t.throws(function(){GetIntrinsic("%NonExistentIntrinsic.prototype.property%")},/%NonExistentIntrinsic%/,"The base intrinsic of %NonExistentIntrinsic.prototype.property% is %NonExistentIntrinsic%"),t.throws(function(){GetIntrinsic("%NonExistentIntrinsicPrototype.property%")},/%NonExistentIntrinsicPrototype%/,"The base intrinsic of %NonExistentIntrinsicPrototype.property% is %NonExistentIntrinsicPrototype%"),t.end()}),t.end()}),test("accessors",{skip:!$gOPD||"function"!=typeof Map},function(t){var r=$gOPD(Map.prototype,"size");t.ok(r,"Map.prototype.size has a descriptor"),t.equal(typeof r.get,"function","Map.prototype.size has a getter function"),t.equal(GetIntrinsic("%Map.prototype.size%"),r.get,"%Map.prototype.size% yields the getter for it"),t.equal(GetIntrinsic("Map.prototype.size"),r.get,"Map.prototype.size yields the getter for it"),t.end()}),test("generator functions",{skip:!generatorFns.length},function(t){var r=GetIntrinsic("%GeneratorFunction%"),e=GetIntrinsic("%Generator%"),n=GetIntrinsic("%GeneratorPrototype%");forEach(generatorFns,function(o){var i=o.name;i=i?"'"+i+"'":"genFn",t.ok(o instanceof r,i+" instanceof %GeneratorFunction%"),t.ok($isProto(e,o),"%Generator% is prototype of "+i),t.ok($isProto(n,o.prototype),"%GeneratorPrototype% is prototype of "+i+".prototype")}),t.end()}),test("async functions",{skip:!asyncFns.length},function(t){var r=GetIntrinsic("%AsyncFunction%"),e=GetIntrinsic("%AsyncFunctionPrototype%");forEach(asyncFns,function(n){var o=n.name;o=o?"'"+o+"'":"asyncFn",t.ok(n instanceof r,o+" instanceof %AsyncFunction%"),t.ok($isProto(e,n),"%AsyncFunctionPrototype% is prototype of "+o)}),t.end()}),test("async generator functions",{skip:0===asyncGenFns.length},function(t){var r=GetIntrinsic("%AsyncGeneratorFunction%"),e=GetIntrinsic("%AsyncGenerator%"),n=GetIntrinsic("%AsyncGeneratorPrototype%");forEach(asyncGenFns,function(o){var i=o.name;i=i?"'"+i+"'":"asyncGenFn",t.ok(o instanceof r,i+" instanceof %AsyncGeneratorFunction%"),t.ok($isProto(e,o),"%AsyncGenerator% is prototype of "+i),t.ok($isProto(n,o.prototype),"%AsyncGeneratorPrototype% is prototype of "+i+".prototype")}),t.end()}),test("%ThrowTypeError%",function(t){var r=GetIntrinsic("%ThrowTypeError%");t.equal(typeof r,"function","is a function"),t.throws(r,TypeError,"%ThrowTypeError% throws a TypeError"),t.end()}),test("allowMissing",{skip:asyncGenFns.length>0},function(t){t.throws(function(){GetIntrinsic("%AsyncGeneratorPrototype%")},TypeError,"throws when missing"),t.equal(GetIntrinsic("%AsyncGeneratorPrototype%",!0),void 0,"does not throw when allowMissing"),t.end()});