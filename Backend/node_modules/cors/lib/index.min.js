!function(){"use strict";var e=require("object-assign"),n=require("vary"),r={origin:"*",methods:"GET,HEAD,PUT,PATCH,POST,DELETE",preflightContinue:!1,optionsSuccessStatus:204};function o(e){return"string"==typeof e||e instanceof String}function t(e,n){if(Array.isArray(n)){for(var r=0;r<n.length;++r)if(t(e,n[r]))return!0;return!1}return o(n)?e===n:n instanceof RegExp?n.test(e):!!n}function i(e,n){var r,i=n.headers.origin,u=[];return e.origin&&"*"!==e.origin?o(e.origin)?(u.push([{key:"Access-Control-Allow-Origin",value:e.origin}]),u.push([{key:"Vary",value:"Origin"}])):(r=t(i,e.origin),u.push([{key:"Access-Control-Allow-Origin",value:!!r&&i}]),u.push([{key:"Vary",value:"Origin"}])):u.push([{key:"Access-Control-Allow-Origin",value:"*"}]),u}function u(e){return!0===e.credentials?{key:"Access-Control-Allow-Credentials",value:"true"}:null}function s(e){var n=e.exposedHeaders;return n?(n.join&&(n=n.join(",")),n&&n.length?{key:"Access-Control-Expose-Headers",value:n}:null):null}function l(e,r){for(var o=0,t=e.length;o<t;o++){var i=e[o];i&&(Array.isArray(i)?l(i,r):"Vary"===i.key&&i.value?n(r,i.value):i.value&&r.setHeader(i.key,i.value))}}module.exports=function(n){var o=null;return o="function"==typeof n?n:function(e,r){r(null,n)},function(n,t,a){o(n,function(o,c){if(o)a(o);else{var g=e({},r,c),h=null;g.origin&&"function"==typeof g.origin?h=g.origin:g.origin&&(h=function(e,n){n(null,g.origin)}),h?h(n.headers.origin,function(e,r){e||!r?a(e):(g.origin=r,function(e,n,r,o){var t=[];"OPTIONS"===(n.method&&n.method.toUpperCase&&n.method.toUpperCase())?(t.push(i(e,n)),t.push(u(e)),t.push(function(e){var n=e.methods;return n.join&&(n=e.methods.join(",")),{key:"Access-Control-Allow-Methods",value:n}}(e)),t.push(function(e,n){var r=e.allowedHeaders||e.headers,o=[];return r?r.join&&(r=r.join(",")):(r=n.headers["access-control-request-headers"],o.push([{key:"Vary",value:"Access-Control-Request-Headers"}])),r&&r.length&&o.push([{key:"Access-Control-Allow-Headers",value:r}]),o}(e,n)),t.push(function(e){var n=("number"==typeof e.maxAge||e.maxAge)&&e.maxAge.toString();return n&&n.length?{key:"Access-Control-Max-Age",value:n}:null}(e)),t.push(s(e)),l(t,r),e.preflightContinue?o():(r.statusCode=e.optionsSuccessStatus,r.setHeader("Content-Length","0"),r.end())):(t.push(i(e,n)),t.push(u(e)),t.push(s(e)),l(t,r),o())}(g,n,t,a))}):a()}})}}}();