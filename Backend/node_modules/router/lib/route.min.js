/*!
 * router
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2022 Douglas Christopher Wilson
 * MIT Licensed
 */
"use strict";const debug=require("debug")("router:route"),Layer=require("./layer"),{METHODS:METHODS}=require("node:http"),slice=Array.prototype.slice,flatten=Array.prototype.flat,methods=METHODS.map(t=>t.toLowerCase());function Route(t){debug("new %o",t),this.path=t,this.stack=[],this.methods=Object.create(null)}module.exports=Route,Route.prototype._handlesMethod=function(t){if(this.methods._all)return!0;let e="string"==typeof t?t.toLowerCase():t;return"head"!==e||this.methods.head||(e="get"),Boolean(this.methods[e])},Route.prototype._methods=function(){const t=Object.keys(this.methods);this.methods.get&&!this.methods.head&&t.push("head");for(let e=0;e<t.length;e++)t[e]=t[e].toUpperCase();return t},Route.prototype.dispatch=function(t,e,o){let r=0;const n=this.stack;let h=0;if(0===n.length)return o();let s="string"==typeof t.method?t.method.toLowerCase():t.method;"head"!==s||this.methods.head||(s="get"),t.route=this,function i(u){if(u&&"route"===u)return o();if(u&&"router"===u)return o(u);if(r>=n.length)return o(u);if(++h>100)return setImmediate(i,u);let a,l;for(;!0!==l&&r<n.length;)a=n[r++],l=!a.method||a.method===s;if(!0!==l)return o(u);u?a.handleError(u,t,e,i):a.handleRequest(t,e,i);h=0}()},Route.prototype.all=function(t){const e=flatten.call(slice.call(arguments),1/0);if(0===e.length)throw new TypeError("argument handler is required");for(let t=0;t<e.length;t++){const o=e[t];if("function"!=typeof o)throw new TypeError("argument handler must be a function");const r=Layer("/",{},o);r.method=void 0,this.methods._all=!0,this.stack.push(r)}return this},methods.forEach(function(t){Route.prototype[t]=function(e){const o=flatten.call(slice.call(arguments),1/0);if(0===o.length)throw new TypeError("argument handler is required");for(let e=0;e<o.length;e++){const r=o[e];if("function"!=typeof r)throw new TypeError("argument handler must be a function");debug("%s %s",t,this.path);const n=Layer("/",{},r);n.method=t,this.methods[t]=!0,this.stack.push(n)}return this}});