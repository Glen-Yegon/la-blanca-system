<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NIAPAY â€” Owner Dashboard</title>

  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400;1,700&family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
 <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
  <!-- Styles -->
  <link rel="stylesheet" href="manager.min.css" />
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <img src="Images/niapaylogo.png" alt="NIAPAY" class="logo" />
        <h1>NIAPAY Manager</h1>
      </div>

      <nav class="nav">
        <button class="nav-btn active" data-area="overview">Overview</button>
        <button class="nav-btn" data-area="jobs">Job Management</button>
        <button class="nav-btn" data-area="staff">Staff Performance</button>
        <button class="nav-btn" data-area="reports">Reports</button>
        <button class="nav-btn" data-area="admin">Admin Controls</button>
        <button class="nav-btn" data-area="activity">Activity Log</button>
      </nav>

      <div class="sidebar-footer">
        <small>Â© 2025 NIAPAY</small>
      </div>
    </aside>

    <header class="dashboard-header">
  <h2 id="welcome-message">Welcome, Manager ðŸ‘‹</h2>
</header>


    <main class="main">
      <header class="topbar">
        <div class="left">
          <h2 id="pageTitle">Overview</h2>
        </div>
        <div class="right">
          <div id="managerName" class="manager-name">Manager</div>
        </div>
      </header>

      <!-- ðŸ”¹ FILTER SECTION -->
<section id="filterSection" class="filter-section">
  <h2>Filter Jobs</h2>
  <div class="filters">
    <select id="dateFilter">
      <option value="all">All Time</option>
      <option value="today">Today</option>
      <option value="week">Past Week</option>
      <option value="month">Past Month</option>
      <option value="3months">Past 3 Months</option>
      <option value="year">Past Year</option>
    </select>
    <button id="applyFilterBtn" class="filter-btn">Apply Filter</button>
  </div>
</section>


      <section class="content">
        <!-- OVERVIEW -->
        <section id="overview" class="panel active">
          <div class="cards-row">
            <div class="card stat" id="statPending">
              <div class="label">Pending</div>
              <div class="value" id="pendingCount">â€”</div>
            </div>
            <div class="card stat" id="statInProgress">
              <div class="label">In Progress</div>
              <div class="value" id="inProgressCount">â€”</div>
            </div>
            <div class="card stat" id="statCompleted">
              <div class="label">Completed</div>
              <div class="value" id="completedCount">â€”</div>
            </div>
            <div class="card stat" id="statRevenue">
              <div class="label">Total Revenue</div>
              <div class="value" id="revenueSum">Kshs 0</div>
            </div>
            <div class="card stat" id="statStaff">
              <div class="label">Active Staff</div>
              <div class="value" id="activeStaff">â€”</div>
            </div>
          </div>

          <div class="panel-block">
            <h3>Quick Jobs Snapshot</h3>
            <div id="quickJobsList" class="list"></div>
          </div>

          <!-- OVERVIEW -->
<div class="export-options">
  <button class="export-btn" data-export-target="overviewPanel">
    <i class="fas fa-file-export"></i> Export Overview
  </button>
</div>

        </section>

        <!-- JOB MANAGEMENT -->
        <section id="jobs" class="panel">
          <div class="panel-top">
            <h3>Active Jobs</h3>
            <div class="filters">
              <select id="filterStatus">
                <option value="all">All statuses</option>
                <option value="Pending">Pending</option>
                <option value="In Progress">In Progress</option>
                <option value="Completed">Completed</option>
              </select>
              <input id="searchInput" placeholder="Search by plate or UUID" />
              <button id="refreshJobs" class="btn small">Refresh</button>
            </div>
          </div>

          <div class="table-wrap">
            <table id="jobsTable" class="jobs-table">
              <thead>
                <tr>
                  <th>UUID</th>
                  <th>Plate</th>
                  <th>Model</th>
                  <th>Assigned</th>
                  <th>Status</th>
                  <th>Total</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>

<!-- JOB MANAGEMENT -->
<div class="export-options">
  <button class="export-btn" data-export-target="jobsTable">
    <i class="fas fa-file-export"></i> Export Jobs
  </button>
</div>
          </div>
        </section>

<!-- STAFF PERFORMANCE -->
<section id="staff" class="panel">
  <h3>Staff Performance</h3>
  <div id="staffGrid" class="staff-grid"></div>

  <div class="export-options">
    <button class="export-btn" data-export-target="staffGrid">
      <i class="fas fa-file-export"></i> Export Staff
    </button>
  </div>
</section>

        <!-- REPORTS -->
        <section id="reports" class="panel">
          <h3>Reports</h3>
          <div class="report-block">
            
            <ul id="reportsList" class="reports-list"></ul>
          </div>

<!-- Reports Section -->
<div class="report-block" id="cashReportsBlock">
  <h4>Mpesa Reports</h4>
  <div class="filters">
    <select id="cashReportDateFilter">
      <option value="all">All Time</option>
      <option value="today">Today</option>
      <option value="week">Past Week</option>
      <option value="month">Past Month</option>
      <option value="3months">Past 3 Months</option>
      <option value="year">Past Year</option>
    </select>
    <button id="generateCashReport" class="filter-btn">
      <i class="fas fa-file-alt"></i> Generate Report
    </button>
    <button id="exportCashReport" class="export-btn">
      <i class="fas fa-file-export"></i> Export Report
    </button>
  </div>
  <ul id="cashReportList" class="reports-list"></ul>
</div>


        </section>

<!-- ADMIN CONTROLS -->
<section id="admin" class="panel">
  <h3>Admin Controls</h3>

  <!-- STAFF MANAGEMENT -->
  <div class="admin-block" id="staffBlock">
    <h4>Staff Management</h4>
    <div class="admin-form">
      <input type="text" id="staffFirstName" placeholder="First Name" />
      <input type="text" id="staffLastName" placeholder="Last Name" />
      <button id="addStaffBtn" class="btn primary">Add Staff</button>
    </div>
    <ul id="staffList" class="admin-list"></ul>
  </div>

  <!-- SERVICES MANAGEMENT -->
  <div class="admin-block" id="servicesBlock">
    <h4>Services Management</h4>
    <div class="admin-form">
      <input type="text" id="serviceName" placeholder="Service Name" />
      <input type="number" id="servicePrice" placeholder="Price (Ksh)" />
      <button id="addServiceBtn" class="btn primary">Add Service</button>
    </div>
    <ul id="servicesList" class="admin-list"></ul>
  </div>

  <!-- COMPANIES MANAGEMENT -->
  <div class="admin-block" id="companiesBlock">
    <h4>Corporate Companies</h4>
    <div class="admin-form">
      <input type="text" id="companyName" placeholder="Full Company Name" />
      <button id="addCompanyBtn" class="btn primary">Add Company</button>
    </div>
    <ul id="companiesList" class="admin-list"></ul>
  </div>
</section>



        <!-- ACTIVITY LOG -->
        <section id="activity" class="panel">
          <h3>Activity Log</h3>
          <div id="activityLog" class="activity-log"></div>


<!-- ACTIVITY LOG -->
<div class="export-options">
  <button class="export-btn" data-export-target="activityLog">
    <i class="fas fa-file-export"></i> Export Activity
  </button>
</div>

        </section>
      </section>
    </main>
  </div>

  <footer class="footer" data-aos="fade-up">
  <div class="footer-content">
    <!-- Logo -->
    <div class="footer-logo">
      <img src="Images/niapaylogo.png" alt="NIAPAY Logo" />
    </div>

    <!-- Links -->
    <div class="footer-links">
      <a href="#">Home</a>
      <a href="#">About</a>
      <a href="#">Demo</a>
      <a href="#">Contact</a>
      <a href="#">Pricing</a>
    </div>

<!-- Social Media Icons -->
<div class="footer-socials">
  <a href="https://www.facebook.com/share/1A1SHZbfsN/?mibextid=wwXIfr"><i class="fab fa-facebook-f"></i></a>
  <a href="https://www.instagram.com/nia_pay_systems?igsh=dXE3Nnd0OTkzOHV3&utm_source=qr"><i class="fab fa-instagram"></i></a>
  <a href="https://x.com/pay_nia?s=21"><i class="fab fa-twitter"></i></a>
    <a href="https://www.tiktok.com/@nia.pay.systems?_t=ZM-90OCsNGK5o8&_r=1"><i class="fab fa-tiktok"></i></a>
</div>

    <!-- Newsletter -->
    <div class="newsletter">
      <p>Subscribe to our newsletter for updates</p>
      <form class="newsletter-form">
        <input type="email" placeholder="Enter your email" required />
        
<button type="submit" class="subscribe-btn">Subscribe</button>

      </form>
    </div>

    <!-- Divider Line -->
    <hr class="footer-line" />

    <!-- Copyright -->
    <p class="footer-copy">
      Â© 2025 NIAPAY. All Rights Reserved. | Designed by
      <span>Pixel Pulse KE</span>
    </p>

<!-- Fun Ending Element -->
<div class="footer-end">
  <i class="fas fa-car"></i>
  <p>Drive your business forward with <strong>NIAPAY</strong></p>
</div>

  </div>
</footer>

<div id="jobModal" class="modal hidden">
  <div class="modal-content">
    <span id="closeJobModal" class="modal-close">&times;</span>

    <h2 class="modal-title">Job Details</h2>

    <div id="modalBody" class="modal-body">
      Loading...
    </div>
  </div>
</div>


  <!-- ðŸ”¹ LOADER -->
<div id="loader" class="loader hidden">
  <div class="spinner"></div>
</div>


  <!-- Toasts -->
  <div id="toast" class="toast" aria-live="polite"></div>

  <!-- Firebase + App logic -->
  <script type="module" src="manager-firebase.min.js"></script>
  <script type="module" src="manager.min.js"></script>
  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.29.0/docxtemplater.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PDFMake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PDFMake/0.2.7/vfs_fonts.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const exportBtn = document.querySelector(".export-btn");
  console.log("Export button element:", exportBtn);

  if (!exportBtn) return console.error("Export button not found!");

  exportBtn.addEventListener("click", async () => {
    console.log("Export button clicked"); // Debug log

    try {
      const formatInput = prompt("Choose export format: PDF, DOCX, or CSV");
      if (!formatInput) {
        console.warn("Export canceled by user");
        return;
      }

      const format = formatInput.toLowerCase();
      console.log("Selected format:", format);

      if (!["pdf","docx","csv"].includes(format)) {
        console.error("Invalid format selected:", format);
        return alert("Invalid format selected!");
      }

      // Gather staff data from rendered grid
      const staffCards = document.querySelectorAll("#staffGrid .staff-card");
      console.log("Found staff cards:", staffCards.length);

      if (!staffCards.length) {
        console.warn("No staff data available to export");
        return alert("No staff data available to export");
      }

      const staffData = Array.from(staffCards).map(card => {
        const name = card.querySelector(".info .name")?.textContent.trim() || "N/A";
        const meta = card.querySelector(".info .meta")?.textContent.trim() || "";
        const [jobsText, revenueText, commissionText] = meta.split("â€¢").map(t => t.trim());
        return { 
          name, 
          jobs: jobsText?.split(": ")[1] || "0", 
          revenue: revenueText?.split(": ")[1] || "0", 
          commission: commissionText?.split(": ")[1] || "0" 
        };
      });

      console.log("Staff data prepared for export:", staffData);

      if (format === "csv") {
        exportCSV(staffData);
      } else if (format === "pdf") {
        exportPDF(staffData);
      } else if (format === "docx") {
        exportDOCX(staffData);
      }

    } catch (err) {
      console.error("Error during export:", err);
      alert("An error occurred while exporting. Check console for details.");
    }
  });

  /* ----------- CSV Export ----------- */
  function exportCSV(data) {
    console.log("Exporting CSV...");
    const headers = ["Name","Jobs Completed","Revenue","Commission"];
    const csvRows = [
      headers.join(","),
      ...data.map(d => `${d.name},${d.jobs},${d.revenue},${d.commission}`)
    ];
    const csvBlob = new Blob([csvRows.join("\n")], { type: "text/csv;charset=utf-8" });
    console.log("CSV blob created");
    saveAs(csvBlob, `Staff_Performance_${new Date().toISOString().slice(0,10)}.csv`);
  }

  /* ----------- PDF Export ----------- */
  function exportPDF(data) {
    console.log("Exporting PDF...");
    const docDefinition = {
      content: [
        { text: 'Staff Performance Report', style: 'header', alignment: 'center' },
        { text: `Generated: ${new Date().toLocaleDateString()}`, style: 'subheader', alignment: 'center', margin: [0,0,0,20] },
        {
          table: {
            headerRows: 1,
            widths: ['*','auto','auto','auto'],
            body: [
              ["Name","Jobs Completed","Revenue","Commission"],
              ...data.map(d => [d.name, d.jobs, d.revenue, d.commission])
            ]
          },
          layout: 'lightHorizontalLines'
        }
      ],
      styles: {
        header: { fontSize: 18, bold: true },
        subheader: { fontSize: 12, italics: true },
      }
    };
    pdfMake.createPdf(docDefinition).download(`Staff_Performance_${new Date().toISOString().slice(0,10)}.pdf`);
    console.log("PDF download triggered");
  }

  /* ----------- DOCX Export ----------- */
  function exportDOCX(data) {
    console.log("Exporting DOCX...");
    try {
      const tableRows = data.map(d => [d.name, d.jobs, d.revenue, d.commission]);
      const docContent = `
        <w:tbl>
          <w:tr>
            <w:tc><w:p><w:r><w:t>Name</w:t></w:r></w:p></w:tc>
            <w:tc><w:p><w:r><w:t>Jobs Completed</w:t></w:r></w:p></w:tc>
            <w:tc><w:p><w:r><w:t>Revenue</w:t></w:r></w:p></w:tc>
            <w:tc><w:p><w:r><w:t>Commission</w:t></w:r></w:p></w:tc>
          </w:tr>
          ${tableRows.map(row => `<w:tr>${row.map(cell => `<w:tc><w:p><w:r><w:t>${cell}</w:t></w:r></w:p></w:tc>`).join('')}</w:tr>`).join('')}
        </w:tbl>
      `;
      const blob = new Blob([docContent], { type: "application/vnd.openxmlformats-officedocument.wordprocessingml.document" });
      saveAs(blob, `Staff_Performance_${new Date().toISOString().slice(0,10)}.docx`);
      console.log("DOCX download triggered");
    } catch (err) {
      console.error("Error generating DOCX:", err);
    }
  }
});
</script>


</body>
</html>
